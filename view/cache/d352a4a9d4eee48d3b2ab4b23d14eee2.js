/**
* THIS GENERATED JS-FILE CONTAINS FOLLOWING FILES:
* - /home/httpd/vhosts/shop.filtex.ch/httpdocs/i4/javascript/i4_document_listener.js
* - /home/httpd/vhosts/shop.filtex.ch/httpdocs/i4/javascript/i4_special.js
* - /home/httpd/vhosts/shop.filtex.ch/httpdocs/i4/plugin/shop_cart/javascript/i4_cart.js
* - /home/httpd/vhosts/shop.filtex.ch/httpdocs/i4/javascript/i4_validator.js
* - /home/httpd/vhosts/shop.filtex.ch/httpdocs/i4/javascript/i4_ajax.js
* - /home/httpd/vhosts/shop.filtex.ch/httpdocs/i4/javascript/i4_translation.js
* - /home/httpd/vhosts/shop.filtex.ch/httpdocs/i4/plugin/image/javascript/i4_image.js
* - /home/httpd/vhosts/shop.filtex.ch/httpdocs/i4/plugin/shop_catalog/javascript/i4_select.js
*/




var i4_Document_listener={items:$H({keyup:$H(),click:$H(),mouseout:$H()}),item_index:0,items_pause:$H(),keyup_handler:0,click_handler:0,mouseout_handler:0,click_position:{},add:function(event_name,options){var result='';var items=this.items.get(event_name);items.set(this.item_index,options);this.items.set(event_name,items);result={event_name:event_name,key:this.item_index};this.item_index++;return result;},remove:function(key){this.items.get(key.event_name).unset(key.key);this.items_pause.unset(key.key);},stop:function(key){var item=this.items.get(key.event_name).get(key.key);if(item){this.items_pause.set(key.key,item);this.items.get(key.event_name).unset(key.key);}},start:function(key){var item=this.items_pause.get(key.key);if(item){this.items.get(key.event_name).set(key.key,item);this.items_pause.unset(key.key);}},run:function(){var keyups=this.items.get('keyup').values();if(this.keyup_handler!=0){this.keyup_handler.stop();this.keyup_handler=0;}
if(keyups.size()>0){this.keyup_handler=document.on('keyup',(function(event){keyups.each(function(options){if(options.callback){var ok=false;if(options.keys.size()>0){options.keys.each(function(item){if(item==event.keyCode){ok=true;$break;}});}else{ok=true;}
if(ok){options.callback();}}});}).bind(this));}
var clicks=this.items.get('click').values();if(this.click_handler!=0){this.click_handler.stop();this.click_handler=0;}
if(clicks.size()>0){this.click_handler=document.on('click',(function(event){this.click_position={top:event.pageY,left:event.pageX};clicks.each(function(options){if(options.callback){var ok=true;if(options.exclude){options.exclude.each(function(item){$$(item).each(function(item1){if(item1===event.target){ok=false;$break;}});if(ok){$break;}});}
if(ok){options.callback();}}});}).bind(this));}
var mouseouts=this.items.get('mouseout').values();if(this.mouseout_handler!=0){this.mouseout_handler.stop();this.mouseout_handler=0;}
if(mouseouts.size()>0){this.mouseout_handler=document.on('mousemove',(function(event){mouseouts.each(function(options){if(options.callback){var ok=false;var distance=0;if(options.distance){distance=options.distance;}
if(options.element){var pointer=event.pointer();var measure_left=options.element.measure('left');var measure_top=options.element.measure('top');var x_min=measure_left-distance;var x_max=measure_left+options.element.measure('width')+distance;var y_min=measure_top-distance;var y_max=measure_top+options.element.measure('height')+distance;if(!(pointer.x>x_min&&pointer.x<x_max)||!(pointer.y>y_min&&pointer.y<y_max)){ok=true;}}
if(ok){options.callback();}}});}).bind(this));}},get_click_position:function(){return this.click_position;},set_click_position:function(position){this.click_position=position;}}
Object.extend(Prototype.Browser,{IE6:Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6,IE7:Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==7,IE8:Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==8,IE9:Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==9,Plugin:{flash:pluginDetector('flash'),pdf:pluginDetector('pdf'),java:pluginDetector('java')}});function i4_log(log,trace){if(window.console!=undefined){if(trace!=undefined&&trace){window.console.trace();}
window.console.log('[i4-log] - ',log);}}
function pluginDetector(plugin){var result=false;if(document.attachEvent){if(plugin=='flash'){try{new ActiveXObject('ShockwaveFlash.ShockwaveFlash');result=true;}catch(e){}}
if(plugin=='pdf'){try{new ActiveXObject('AcroPDF.PDF');result=true;}catch(e){try{new ActiveXObject('PDF.PdfCtrl');result=true;}catch(e){}}}}else{var plugins=navigator.plugins;for(var i=0;i<plugins.length;i++){if(plugin=='flash'&&plugins[i].description.search(/Flash/)!=-1){result=true;}else if(plugin=='pdf'&&plugins[i].description.search(/Adobe PDF/)!=-1){result=true;}}}
if(plugin=='java'&&navigator.javaEnabled()){result=true;}
return result;}
function is_element_in_viewport(element){var result=true;var elemOffset=element.viewportOffset();var vp=document.viewport.getDimensions();if(elemOffset.left<0||elemOffset.top<0){result=false;}
if((elemOffset.left+element.getWidth())>vp.width||(elemOffset.top+element.getHeight())>vp.height){result=false;}
return result;}
var i4_Cart={cart:[],product:$H(),in_progress:false,option:{ajax_call_change:'product_change',ajax_call_delete:'product_delete',ajax_call_view_update:'view_update',ajax_url:'',ajax_parameter:{},currency:'',update_class_quantity_prefix:'update_quantity_',update_class_subtotal_prefix:'update_subtotal_',update_class_total:'update_subtotal',class_loader:'cart_loader'},set_option:function(option){this.option=Object.extend(this.option,option);},add:function(cart){this.cart.push(Object.extend({div_id:null,ajax_parameter:null},cart));return this;},register_product:function(product){var product=Object.extend({product_id:null,plugin_id:null,button_add_id:null,button_delete_id:null,textfield_id:null,single_price:null,quantity:null,url:''},product);this.product.set(product.product_id,product);if($(product.button_add_id)){$(product.button_add_id).on('click',(function(){if(!this.in_progress&&(!product.textfield_id||!$(product.textfield_id).hasClassName('invalid'))){this.set_progress(true);var quantity=1;if($(product.textfield_id)){var quantity=$F(product.textfield_id);}
var parameter=Object.extend({product_instance_id:product.product_id,product_plugin_id:product.plugin_id,quantity:quantity,call:this.option.ajax_call_change,url_product:product.url},this.option.ajax_parameter);i4_Ajax.factory().set_ajax_file(this.option.ajax_url+'?'+Object.toQueryString(parameter)).set_option({on_success:(function(response){if(response.responseJSON.success){this.product.get(product.product_id).quantity=response.responseJSON.quantity;if(response.responseJSON.change_type=='add'){this.update_cart(true);}else if(response.responseJSON.change_type=='update'){this.recalculate(product.product_id);}}else{this.set_progress(false);}
$(product.textfield_id).setValue(1);}).bind(this)}).run();}}).bind(this));}else if($(product.textfield_id)){this.product.get(product.product_id).quantity=$F(product.textfield_id);$(product.textfield_id).on('keyup',(function(){if($F(product.textfield_id)==''){$(product.textfield_id).setValue(1);}
var saved_quantity=this.product.get(product.product_id).quantity;var quantity=$F(product.textfield_id);if(i4_Validator.is_valid_integer(product.textfield_id,{})){if(!this.in_progress&&saved_quantity!=quantity){this.set_progress(true);var parameter=Object.extend({product_instance_id:product.product_id,product_plugin_id:product.plugin_id,quantity_replace:quantity,call:this.option.ajax_call_change},this.option.ajax_parameter);i4_Ajax.factory().set_ajax_file(this.option.ajax_url+'?'+Object.toQueryString(parameter)).set_option({on_success:(function(response){if(response.responseJSON.success){this.product.get(product.product_id).quantity=response.responseJSON.quantity;if(response.responseJSON.change_type=='update'){this.recalculate(product.product_id);}}else{this.set_progress(false);}}).bind(this)}).run();}}else{$(product.textfield_id).setValue(saved_quantity);}}).bind(this));}
if($(product.button_delete_id)){$(product.button_delete_id).on('click',(function(){if(!this.in_progress){this.set_progress(true);$(product.button_delete_id).up('li').blindUp({duration:0.5,scaleFromCenter:true,afterFinish:(function(){$(product.button_delete_id).up('li').remove();this.product.unset(product.product_id);var parameter=Object.extend({product_instance_id:product.product_id,product_plugin_id:product.plugin_id,call:this.option.ajax_call_delete},this.option.ajax_parameter);i4_Ajax.factory().set_ajax_file(this.option.ajax_url+'?'+Object.toQueryString(parameter)).set_option({on_success:(function(response){this.recalculate(product.product_id);}).bind(this)}).run();}).bind(this)});}}).bind(this));}},update_cart:function(added){this.cart.each(function(item){var parameter=Object.extend({call:this.option.ajax_call_view_update},item.ajax_parameter);parameter=Object.extend(parameter,this.option.ajax_parameter);i4_Ajax.factory().set_id(item.div_id).set_ajax_file(this.option.ajax_url+'?'+Object.toQueryString(parameter)).set_option({on_complete:(function(){if(added){if(!is_element_in_viewport($(item.div_id).down('li'))){new Effect.ScrollTo($(item.div_id).down('li'),{duration:0.5,offset:-12});}
new Effect.Highlight($(item.div_id).down('li'),{startcolor:'#f3f041',duration:2});new Effect.Shake($(item.div_id).up('div.component_cart'),{duration:0.5,distance:2});}
this.set_progress(false);}).bind(this)}).run();},this);},recalculate:function(product_id){if(this.product.size()==0){window.location.reload();}else{var product=this.product.get(product_id);if(product){$$('.'+this.option.update_class_quantity_prefix+product.product_id).invoke('update',product.quantity);$$('.'+this.option.update_class_subtotal_prefix+product.product_id).each(function(item){item.update(this.option.currency+' '+(product.quantity*product.single_price).toFixed(2));if(!is_element_in_viewport(item.up('li'))){new Effect.ScrollTo(item.up('li'),{duration:0.5,offset:-12});}
if(item.up('div.component_cart')){new Effect.Highlight(item.up('li'),{queue:{position:'end',scope:'cart'+product.product_id,limit:3},startcolor:'#f3f041',duration:2,restorecolor:'#ffffff',afterFinish:(function(){}).bind(this)});new Effect.Shake(item.up('div.component_cart'),{queue:{position:'end',scope:'cart'+product.product_id,limit:3},duration:0.5,distance:2});}},this);}
var subtotal=0;this.product.each(function(item){subtotal=subtotal+(item.value.quantity*item.value.single_price);});$$('.'+this.option.update_class_total).invoke('update',this.option.currency+' '+subtotal.toFixed(2));this.set_progress(false);}},set_progress:function(bool){this.in_progress=bool;if(bool){$$('.'+this.option.class_loader).invoke('show');}else{$$('.'+this.option.class_loader).each(function(item){Element.hide.delay(0.5,item);});}}}
var i4_Validator={instances:[],get:function(form_id){if($(form_id)){if($(form_id).tagName.toUpperCase()!='FORM'){form_id=$(form_id).up('form').readAttribute('id');}}else{throw('i4_validator.js: form_id does not exist: '+form_id);}
var instance=this.get_instance_by_form_id(form_id);if(instance==null){instance=new i4_Validator_instance();instance.set_form_id(form_id);this.instances.push([form_id,instance]);}
return instance;},get_instance_by_form_id:function(form_id){var instance=null;this.instances.each(function(item){if(item[0]==form_id){instance=item[1];}});return instance;},is_valid_integer:function(id,parameter){var result=true;var value=$F(id);if(value==""){result=false;}
if(isNaN(value)){result=false;}
if(parseFloat(value)!=parseInt(value)){result=false;}
if(parameter.max_length&&value>parameter.max_length){result=false;}
if(parameter.min_length&&value<parameter.min_length){result=false;}
if(parameter.rejected_value&&parameter.rejected_value.include(value)){result=false;}
if(parameter.required==0&&value==""){result=true;}
return result;}}
var i4_Validator_instance=Class.create({submit:true,submit_ajax:false,list:[],invalid_list:[],disable_list:[],from_id:'',callback:{submit_ajax_success:function(){},before_submit:function(){},after_submit:function(){}},before_submit_function:false,after_loaded_function:false,after_loaded_function_counter:0,initialize:function(){this.list=new Array();this.invalid_list=new Array();this.disable_list=new Array();this.submit_ajax=false;this.clear();},set_form_id:function(id){this.form_id=id;return this;},set_submit:function(submit){this.submit=submit;return this;},set_submit_ajax:function(v){this.submit_ajax=v;return this;},set_callback:function(callback){this.callback=Object.extend(this.callback,callback);return this;},add:function(item){this.list.push(item);return this;},remove:function(id){this.list.each(function(item){if(item.element_id==id){this.list=this.list.without(item);}},this);this.invalid_list.each(function(item){if(item==id){this.invalid_list=this.invalid_list.without(item);}},this);return this;},clear:function(){this.list.clear();this.invalid_list.clear();this.after_loaded_function=null;this.before_submit_function=null;this.after_loaded_function_counter=0;},start_observing:function(){this.list.each(function(item){$(item.element_id).on('i4:change',(function(){this.check_item(item);this.update_item_style(item);if(item.check_element&&item.check_element.size()>0){item.check_element.each(function(element){var check_item=this.get_item(element);this.check_item(check_item);this.update_item_style(check_item);},this);}
this.update_submit();}).bind(this));},this);if(this.after_loaded_function_counter>0){for(var i=0;i<this.after_loaded_function_counter;i++){eval('i4_Validator.'+this.form_id+'_after_loaded_function'+i+'()');}}
this.check_form();},check_form:function(){this.invalid_list.clear();this.list.each(function(item){this.check_item(item);},this);this.update_style();this.update_submit();},check_item:function(item){if(item!=''){var function_string='this.'+item.function_name+'("'+item.element_id+'", '+Object.toJSON(item.function_parameter)+')';if(!eval(function_string)){this.set_invalid(item.element_id);}else{this.set_valid(item.element_id);}}},set_invalid:function(element_id){this.invalid_list.push(element_id);this.invalid_list=this.invalid_list.uniq();},set_valid:function(element_id){this.invalid_list=this.invalid_list.without(element_id);},update_style:function(){this.list.each(function(item){this.update_item_style(item);},this);},update_item_style:function(item){if(this.invalid_list.indexOf(item.element_id)<0){$(item.element_id).addClassName("valid");$(item.element_id).removeClassName("invalid");}else{$(item.element_id).addClassName("invalid");$(item.element_id).removeClassName("valid");}
if(this.is_empty(item.element_id)&&item.function_parameter.required==0){$(item.element_id).removeClassName("invalid");$(item.element_id).removeClassName("valid");}},update_submit:function(){var button=$(this.form_id).down("button[type='submit']");if(this.invalid_list.size()==0){if(button){button.removeClassName("invalid");button.addClassName("valid");button.setStyle({"cursor":"pointer"});}
$(this.form_id).onsubmit=(function(){if(this.before_submit_function){eval('i4_Validator.'+this.form_id+'_before_submit_function()');}
this.callback.before_submit();setTimeout((function(){this.callback.after_submit();}).bind(this),400);if(!this.submit_ajax){if(this.submit){if(/AppleWebKit|MSIE/.test(navigator.userAgent)){new Ajax.Request("/ping/close",{asynchronous:false});}
return true;}else{return false;}}else{i4_Ajax.factory().set_parameter($(this.form_id).serialize()).set_option({on_success:(function(response){this.callback.submit_ajax_success(response.responseJSON);}).bind(this)}).run();return false;}}).bind(this)}else{if(button){button.removeClassName("valid");button.addClassName("invalid");button.setStyle({"cursor":"default"});}
$(this.form_id).onsubmit=function(){return false;}}},disable:function(element_id){var disabled_item=this.get_item(element_id);if(disabled_item!=''){this.disable_list.push(disabled_item);this.list=this.list.without(disabled_item);}
return this;},enable:function(element_id){var enabled_item='';this.disable_list.each(function(item){if(item.element_id==element_id){enabled_item=item;}});if(enabled_item!=''){this.list.push(enabled_item);this.disable_list=this.disable_list.without(enabled_item);}
return this;},required:function(element_id){var item=this.get_item(element_id);if(item!=''){item.function_parameter.required=true;}},optional:function(element_id){var item=this.get_item(element_id);if(item!=''){item.function_parameter.required=false;}},get_item:function(element_id){var result='';this.list.each(function(item){if(item.element_id==element_id){result=item;}});return result;},after_loaded:function(func){var after_loaded='i4_Validator.'+this.form_id+'_after_loaded_function'+this.after_loaded_function_counter+' = '+func;eval(after_loaded);this.after_loaded_function_counter++;return this;},before_submit:function(func){var before_submit='i4_Validator.'+this.form_id+'_before_submit_function = '+func;eval(before_submit);this.before_submit_function=true;return this;},is_empty:function(id){var result=false;if($(id).tagName.toUpperCase()=='DIV'){if(this.get_item(id).function_name=='is_valid_image'){result=this.is_empty_image(id);}}else{if($F(id)==''){result=true;}}
return result;},is_empty_image:function(id){result=true;var file_input_id=id.split('container_')[1];if($(file_input_id+'_preview')){result=false;}else{if($(id).down('input[type=radio]')&&$(id).down('input[type=radio]').checked|| ($(file_input_id)&&!$('image_choose_'+file_input_id))){if($(file_input_id).getValue()!=''){result=false;}}else{if($(id).down('img.selected_preview')){result=false;}}}
return result;},is_valid_string:function(id,parameter){var result=true;var value=$F(id);if(value==""){result=false;}
if(parameter.max_length&&value.length>parameter.max_length){result=false;}
if(parameter.min_length&&value.length<parameter.min_length){result=false;}
if(parameter.disallow_words){parameter.disallow_words.each(function(item){if(value==item){result=false;}});}
if(parameter.character_invalid){parameter.character_invalid.each(function(item){if(value.include(item)){result=false;}});}
if(parameter.rejected_start_string){parameter.rejected_start_string.each(function(item){if(value.startsWith(item)){result=false;}});}
if(parameter.required==0&&value==""){result=true;}
return result;},is_valid_integer:function(id,parameter){return i4_Validator.is_valid_integer(id,parameter);},is_valid_number:function(id,parameter){var result=true;var value=$F(id);if(value==""){result=false;}
if(isNaN(value)){result=false;}
if(parameter.max_length&&value>parameter.max_length){result=false;}
if(parameter.min_length&&value<parameter.min_length){result=false;}
if(parameter.rejected_value.include(value)){result=false;}
if(parameter.required==0&&value==""){result=true;}
return result;},is_valid_phone:function(id,parameter){var result=true;var value=$F(id);if(value==""){result=false;}
var clean=value.replace(/^[\+]/g,'');clean=clean.replace(/[\.\(\)\s\/-]/g,'');if(clean.match(/^[0-9]+$/g)==null){result=false;}
if(value.length<8){result=false;}
if(parameter.required==0&&value==""){result=true;}
return result;},is_valid_url:function(id,parameter){var result=true;var value=$F(id);if(value==""){result=false;}
if(!value.startsWith('http://')&&!value.startsWith('https://')){result=false;}
if(parameter.required==0&&value==""){result=true;}
return result;},is_valid_mail:function(id,parameter){var result=true;var value=$F(id);if(value==""){result=false;}
if(value.match(/^[_a-z0-9äáàâçëéèêïíìîiñöóòôüúùû-]+([._a-z0-9äáàâçëéèêïíìîiñöóòôüúùû+-]+)*@[a-z0-9äáàâçëéèêïíìîiñöóòôüúùû+-]+(.[a-z0-9\-äáàâçëéèêïíìîiñöóòôüúùû]+)*\.([a-z]{2,4})$/i)==null){result=false;}
if(parameter.required==0&&value==""){result=true;}
return result;},is_valid_file:function(id,parameter){var result=true;var value=$F(id);if(value==""){result=false;}
if(parameter.extensions){var ext_valid=false;var splitted=value.split(".");var ext=splitted[splitted.length-1];parameter.extensions.each(function(item){if(ext.toLowerCase()==item.toLowerCase()){ext_valid=true;}});if(!ext_valid){result=false;}}
if($(id+'_preview')&&value==""){result=true;}
if(parameter.required==0&&value==""){result=true;}
return result;},is_valid_image:function(id,parameter){var result=true;var file_input_id=id.split('container_')[1];if($(id).down('input[type=radio]')&&$(id).down('input[type=radio]').checked|| ($(file_input_id)&&!$('image_choose_'+file_input_id))){if(!this.is_valid_file(file_input_id,parameter)){result=false;}}else{if(!$(file_input_id+'_preview')&&parameter.required==1&&!$(id).down('img.selected_preview')){result=false;}}
return result;},is_valid_date:function(id,parameter){var result=true;var value=$F(id);if(value==""){result=false;}
var check_date=new Date();var year='';var month='';var day='';var splitted_en=value.split("-");var splitted_de=value.split(".");if(splitted_en.size()==3){year=splitted_en[0];month=splitted_en[1];day=splitted_en[2];}else if(splitted_de.size()==3){year=splitted_de[2];month=splitted_de[1];day=splitted_de[0];}
check_date=new Date(year,month-1,day);if(check_date=='Invalid Date'){result=false;}
if(year==''||month==''||day==''){result=false;}
if(month<1||month>12){result=false;}
if(year<1000||year>9999){result=false;}
if(day>32){result=false;}
var today=new Date();if(parameter.future&&check_date<today){result=false;}
if(parameter.required==0&&value==''){result=true;}
return result;},is_valid_time:function(id,parameter){var result=true;var value=$F(id);if(value==""){result=false;}
var splitted=value.split(":");if(splitted.size()>1&&splitted.size()<4){var hour=splitted[0];var minutes=splitted[1];var seconds=0;if(splitted.size()==3){seconds=splitted[2];}
if(hour<0||hour>23||isNaN(hour)){result=false;}
if(minutes<0||minutes>59||isNaN(minutes)){result=false;}
if(seconds<0||seconds>59||isNaN(seconds)){result=false;}}else{result=false;}
if(parameter.required==0&&value==''){result=true;}
return result;},is_checked:function(id,parameter){var result=true;if(!$(id).checked){result=false;}
if(parameter.required==0){result=true;}
return result;},is_valid_compare:function(id,parameter){var result=true;var value=$F(id);if(parameter.required&&value==""){result=false;}else if(parameter.compare_field&&parameter.compare_field!=''){var compare_value=$F(parameter.compare_field);result=(compare_value=='')||(value==compare_value);}
return result;},is_valid_callback:function(id,parameter){var result=false;var value=$F(id);var parameter_value=$H();if(!Object.isArray(parameter.parameter_field)){$H(parameter.parameter_field).each(function(item){parameter_value.set(item.key,$F(item.value));});}
if(!Object.isArray(parameter.parameter_value)){$H(parameter.parameter_value).each(function(item){parameter_value.set(item.key,item.value);});}
if(parameter.callback_plugin!=''){var ajax_file=parameter.url+'?js='+parameter.plugin+'&call='+parameter.action+'&value='+value+(parameter_value.size()==0?'':'&'+parameter_value.toQueryString());$(id).addClassName('loader');i4_Ajax.factory().set_ajax_file(ajax_file).set_option({on_success:(function(response){if(response.responseText==1){this.set_valid(id);}else{this.set_invalid(id);}
this.update_item_style(this.get_item(id));this.update_submit();$(id).removeClassName('loader');}).bind(this)}).run();}
if(parameter.required==1&&value==""){result=false;}
return result;}});var i4_Ajax={ajax_file:'',set_ajax_file:function(v){this.ajax_file=v;return this;},factory:function(){var ajax=new i4_Ajax_instance();ajax.set_ajax_file(this.ajax_file);return ajax;}}
var i4_Ajax_instance=Class.create({id:'',ajax_file:'',parameter:'',option:{},initialize:function(){this.option={on_success:function(){},on_comlete:function(){}};},set_id:function(v){this.id=v;return this;},set_ajax_file:function(v){this.ajax_file=v;return this;},set_parameter:function(v){this.parameter='&'+v;return this;},set_option:function(option){this.option=Object.extend(this.option,option);return this;},run:function(){if(this.ajax_file!=''){if(this.id!=''&&$(this.id)){new Ajax.Updater(this.id,this.ajax_file+this.parameter,{evalScripts:true,asynchronous:true,onSuccess:(function(transport){this.option.on_success(transport);}).bind(this),onComplete:(function(transport){if($(this.id).down('.ajax_javascript')){var js_code=this.html_entity_decode($(this.id).down('.ajax_javascript').innerHTML);if(window.execScript){window.execScript(js_code);}else{window.setTimeout(js_code,0);}
$(this.id).down('.ajax_javascript').remove();}
this.option.on_complete(transport);}).bind(this)});}else{new Ajax.Request(this.ajax_file+this.parameter,{evalScripts:true,asynchronous:true,onSuccess:(function(transport){this.option.on_success(transport);}).bind(this),onComplete:(function(transport){this.option.on_complete(transport);}).bind(this)});}}else{throw('i4_ajax.js - ajax_file not set');}},html_entity_decode:function(str){var ta=document.createElement('textarea');ta.innerHTML=str.replace(/</g,'&lt;').replace(/>/g,'&gt;');return ta.value;}});var i4_Ajax_url={current:'',parameter:$H(),callbacks:$H(),initialize:function(){new PeriodicalExecuter((function(){this.check();}).bind(this),0.5);},check:function(){if(this.current!=document.location.hash){this.current=document.location.hash;i4_log(this.current);this.read_parameter();this.callbacks.each(function(item){item.value.callback(this.parameter);},this);}},read_parameter:function(){this.parameter=$H();var splits=this.current.substring(1).split('&');splits.each(function(item){var param=item.split('=');if(param.size()==1){this.parameter.set(param[0],'');}else if(param.size()==2){this.parameter.set(param[0],param[1]);}},this);},set_parameter:function(key,value){this.parameter.set(key,value);return this;},get_href:function(){result='';if(this.parameter.size()>0){result='#'+this.parameter.toQueryString();}
return result;},callback:function(object){this.callbacks.set(object.id,object);}}
i4_Ajax_url.initialize();var i4_Translation={translations:{},set:function(translations){this.translations=Object.extend(this.translations,translations);},get:function(){return this.translations;}}
var i4_Gallery={instances:$H(),get:function(container_id){result=null;if(this.instances.get(container_id)){result=this.instances.get(container_id);}else{var instance=new i4_Gallery_instance(container_id);this.instances.set(container_id,instance);result=instance;}
return result;}};var i4_Gallery_instance=Class.create({id:null,option:{},images:[],images_count:0,prepared:false,keyup_listener:{next:null,prev:null,esc:null},set_option:function(option){this.option=Object.extend(this.option,option);return this;},initialize:function(container_id){this.id=container_id;this.images=[];this.option={view_container:'',width:300};},add_image:function(image){if($(image.tn_id)){image.slide=this.images_count++;this.images.push(image);$(image.tn_id).setStyle({cursor:'pointer'});$(image.tn_id).next('.plus').setStyle({cursor:'pointer'});$(image.tn_id).on('click',(function(){this.tn_click(image);}).bind(this));$(image.tn_id).next('.plus').on('click',(function(){this.tn_click(image);}).bind(this));}},tn_click:function(image){if(!this.prepared){this.prepare(image.slide);}else{$(this.id).show();$(image.properties_id).show();J('#'+'slider_'+this.id).cycle(image.slide);}
$(this.option.view_container).hide();$(this.id).show();Effect.ScrollTo(this.id,{duration:0.4,offset:-40});if(image.slide==0){$(this.id).down('.prev').hide();i4_Document_listener.stop(this.keyup_listener.prev);}else{$(this.id).down('.prev').show();i4_Document_listener.start(this.keyup_listener.prev);}
if(image.slide==this.images_count-1){$(this.id).down('.next').hide();i4_Document_listener.stop(this.keyup_listener.next);}else{$(this.id).down('.next').show();i4_Document_listener.start(this.keyup_listener.next);}
i4_Document_listener.start(this.keyup_listener.esc);i4_Document_listener.run();},prepare:function(starting_slide){var translations=i4_Translation.get();var view_container_layout=$(this.option.view_container).getLayout().toCSS();$(this.option.view_container).insert({before:new Element('div',{id:this.id}).addClassName('image_slider_container').setStyle({float:'left',width:view_container_layout.width,paddingLeft:view_container_layout.paddingLeft,marginLeft:view_container_layout.marginLeft,marginTop:view_container_layout.marginTop}).insert({top:new Element('div',{id:'slider_'+this.id}).addClassName('slider')}).insert({top:"<div id='slider_navigation'> <div class='left'><a class='prev' href='javascript://'>"+translations.prev+"</a></div> <div class='center'><span class='position'></span><a class='back_button' href='javascript://'>"+translations.back+"</a></div> <div class='right'><a class='next' href='javascript://'>"+translations.next+"</a></div> </div>"}).insert({top:new Element('img',{src:this.option.loader_src}).addClassName('loader_gif')})});$(this.id).down('img.loader_gif').setStyle({left:($(this.id).getWidth()/2)-18+'px'});$(this.id).down('.back_button').on('click',(function(){this.close();}).bind(this));this.images.each((function(item){$('slider_'+this.id).insert({bottom:$(item.properties_id).insert({top:new Element('img',{src:$(item.properties_id).down('.src').innerHTML,alt:$(item.properties_id).down('.alt').innerHTML}).observe('click',(function(){this.close();}).bind(this)).setStyle({cursor:'pointer'})}).hide()});$(item.properties_id).down('.src').remove();$(item.properties_id).down('.alt').remove();}).bind(this));var container=$(this.id);var count_slider=this.images_count;var slider_width=this.option.width;if(count_slider>1){J('#'+'slider_'+this.id).cycle({startingSlide:starting_slide,fx:'fade',speed:500,timeout:0,cleartypeNoBg:true,fit:true,width:slider_width,next:'#'+this.id+' .next',prev:'#'+this.id+' .prev',before:function(current,next,opts){container.down('img.loader_gif').show();next.hide();var image=new Image();image.onload=function(){var img_layout=next.getLayout().toCSS();next.up('.slider').setStyle({height:img_layout.height,width:img_layout.width});container.down('img.loader_gif').hide();next.show();}
image.src=next.down('img').readAttribute('src');},after:function(current,next,opts){container.down('.position').update((opts.currSlide+1)+'/'+opts.slideCount);},onPrevNextEvent:(function(isNext,zeroBasedSlideIndex,slideElement){if(zeroBasedSlideIndex==0){container.down('.prev').hide();i4_Document_listener.stop(this.keyup_listener.prev);}else{container.down('.prev').show();i4_Document_listener.start(this.keyup_listener.prev);}
if(zeroBasedSlideIndex==count_slider-1){container.down('.next').hide();i4_Document_listener.stop(this.keyup_listener.next);}else{container.down('.next').show();i4_Document_listener.start(this.keyup_listener.next);}
i4_Document_listener.run();}).bind(this)});}else{$(this.id).down('div.slider').down('div').appear({duration:0.3});}
this.keyup_listener.next=i4_Document_listener.add('keyup',{keys:[39],callback:(function(){J('#'+$(this.id).down('.slider').readAttribute('id')).cycle('next');}).bind(this)});this.keyup_listener.prev=i4_Document_listener.add('keyup',{keys:[37],callback:(function(){J('#'+$(this.id).down('.slider').readAttribute('id')).cycle('prev');}).bind(this)});this.keyup_listener.esc=i4_Document_listener.add('keyup',{keys:[27],callback:(function(){this.close();}).bind(this)});this.prepared=true;},close:function(){$(this.id).hide();$(this.option.view_container).show();$$('#'+this.id+' .slider > div').invoke('hide');i4_Document_listener.stop(this.keyup_listener.next);i4_Document_listener.stop(this.keyup_listener.prev);i4_Document_listener.stop(this.keyup_listener.esc);i4_Document_listener.run();}});i4_Select={instances:[],factory:function(){var instance=new i4_Select_instance();this.instances.push(instance);return instance;},hide_all:function(){this.instances.invoke('hide');}}
var i4_Select_instance=Class.create({id:'',option:{},initialize:function(){this.option={one_open:true,ajax_url:false};},set_id:function(id){this.id=id;return this;},set_option:function(option){this.option=Object.extend(this.option,option);return this;},run:function(){if(this.option.ajax_url){$$('#'+this.id+' a').each(function(link){var href=link.readAttribute('href');href=href.replace("?","#");link.writeAttribute('href',href);});}
this.hide();$(this.id).down('.selection').on('click',(function(){if(this.option.one_open){i4_Select.hide_all();}
if(Prototype.Browser.IE7){$(this.id).setStyle({'position':'relative'});}
$(this.id).down('ul').show();}).bind(this));var index_click=i4_Document_listener.add('click',{exclude:['#'+this.id+' .selection','#'+this.id+' ul a'],callback:(function(){this.hide();}).bind(this)});i4_Document_listener.run();},hide:function(){if(Prototype.Browser.IE7){$(this.id).setStyle({'position':'static'});}
$(this.id).down('ul').hide();}});